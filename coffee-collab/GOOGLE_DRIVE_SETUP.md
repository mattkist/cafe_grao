# Configura√ß√£o do Google Drive para Upload Autom√°tico

Este guia explica como configurar o upload autom√°tico de imagens para o Google Drive usando OAuth2.

---

## üìã Pr√©-requisitos

1. Conta Google (Gmail)
2. Acesso ao Google Cloud Console
3. Uma pasta no Google Drive onde as imagens ser√£o armazenadas

---

## üîß Passo 1: Criar Projeto no Google Cloud Console

1. Acesse: https://console.cloud.google.com/
2. Clique em **"Selecionar projeto"** (no topo) ‚Üí **"Novo projeto"**
3. D√™ um nome ao projeto (ex: "Coffee Collab Drive")
4. Clique em **"Criar"**
5. Aguarde alguns segundos at√© o projeto ser criado

---

## üîß Passo 2: Habilitar Google Drive API

1. No menu lateral, v√° em **"APIs e Servi√ßos"** ‚Üí **"Biblioteca"**
2. Na barra de busca, digite: **"Google Drive API"**
3. Clique na op√ß√£o **"Google Drive API"**
4. Clique no bot√£o **"ATIVAR"**
5. Aguarde alguns segundos at√© a ativa√ß√£o

---

## üîß Passo 3: Criar Credenciais OAuth2

### 3.1. Configurar Tela de Consentimento

1. No menu lateral, v√° em **"APIs e Servi√ßos"** ‚Üí **"Tela de consentimento OAuth"**
2. Selecione **"Externo"** e clique em **"CRIAR"**
3. Preencha os campos obrigat√≥rios:
   - **Nome do app**: "Coffee Collab" (ou o nome que preferir)
   - **Email de suporte do usu√°rio**: Seu email
   - **Logotipo do app**: (opcional)
   - **Dom√≠nios autorizados**: Deixe vazio por enquanto
4. Clique em **"SALVAR E CONTINUAR"**
5. Em **"Escopos"**, clique em **"ADICIONAR OU REMOVER ESCOPOS"**
   - Marque: **"drive.file"** (Acesso aos arquivos criados pelo app)
   - Clique em **"ATUALIZAR"** e depois **"SALVAR E CONTINUAR"**
6. Em **"Usu√°rios de teste"**, clique em **"ADICIONAR USU√ÅRIOS"**
   - Adicione seu email (e emails dos outros usu√°rios que usar√£o o sistema)
   - Clique em **"SALVAR E CONTINUAR"**
7. Clique em **"VOLTAR AO PAINEL"**

### 3.2. Criar Credenciais OAuth2

1. No menu lateral, v√° em **"APIs e Servi√ßos"** ‚Üí **"Credenciais"**
2. Clique em **"+ CRIAR CREDENCIAIS"** ‚Üí **"ID do cliente OAuth"**
3. Selecione **"Aplicativo da Web"**
4. Preencha:
   - **Nome**: "Coffee Collab Web Client"
   - **Origens JavaScript autorizadas**: 
     - `http://localhost:5173` (para desenvolvimento local - IMPORTANTE!)
     - `http://localhost` (tamb√©m adicione sem porta para evitar erros)
     - `https://seu-usuario.github.io` (para produ√ß√£o no GitHub Pages)
   - **URIs de redirecionamento autorizados**:
     - `http://localhost:5173` (para desenvolvimento local)
     - `https://seu-usuario.github.io` (para produ√ß√£o no GitHub Pages)
5. Clique em **"CRIAR"**
6. **IMPORTANTE**: Copie e salve:
   - **ID do Cliente** (ex: `123456789-abcdefg.apps.googleusercontent.com`)
   
   ‚ö†Ô∏è **GUARDE ESSAS INFORMA√á√ïES EM SEGURAN√áA!**
   
   **Nota**: A chave secreta n√£o √© necess√°ria para Google Identity Services (GIS) no frontend.

---

## üîß Passo 4: Criar Pasta no Google Drive e Obter ID

1. Acesse: https://drive.google.com/
2. Clique em **"+ Novo"** ‚Üí **"Pasta"**
3. D√™ um nome (ex: "Coffee Collab Images")
4. **Clique com bot√£o direito na pasta** ‚Üí **"Compartilhar"** ‚Üí **"Alterar"**
5. Selecione **"Qualquer pessoa com o link"** ‚Üí **"Visualizador"**
6. **Copie o link da pasta** (ex: `https://drive.google.com/drive/folders/1a2b3c4d5e6f7g8h9i0j`)
7. **Extraia o ID da pasta** do link:
   - O ID √© a parte ap√≥s `/folders/`
   - Exemplo: Se o link √© `https://drive.google.com/drive/folders/1a2b3c4d5e6f7g8h9i0j`
   - O ID √©: `1a2b3c4d5e6f7g8h9i0j`

---

## üîß Passo 5: Configurar Vari√°veis de Ambiente

### 5.1. Desenvolvimento Local

1. No projeto, crie um arquivo `.env` na pasta `coffee-collab/` (se n√£o existir)
2. Adicione as seguintes vari√°veis:

```env
# Google OAuth (para Google Drive)
VITE_GOOGLE_CLIENT_ID=seu-id-do-cliente-aqui
VITE_GOOGLE_DRIVE_FOLDER_ID=seu-id-da-pasta-aqui

# Firebase Configuration (obrigat√≥rio)
# Veja instru√ß√µes detalhadas em FIREBASE_SETUP.md
VITE_FIREBASE_API_KEY=sua-api-key-aqui
VITE_FIREBASE_AUTH_DOMAIN=seu-projeto.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=seu-projeto-id
VITE_FIREBASE_STORAGE_BUCKET=seu-projeto.firebasestorage.app
VITE_FIREBASE_MESSAGING_SENDER_ID=seu-sender-id
VITE_FIREBASE_APP_ID=seu-app-id
VITE_FIREBASE_MEASUREMENT_ID=seu-measurement-id
```

**Exemplo com valores do projeto atual:**
```env
# Firebase Configuration
VITE_FIREBASE_API_KEY=AIzaSyB654645aC7y9LYoqBx1C3nHpNrk
VITE_FIREBASE_AUTH_DOMAIN=seila.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=seila
VITE_FIREBASE_STORAGE_BUCKET=seila.firebasestorage.app
VITE_FIREBASE_MESSAGING_SENDER_ID=6433654783
VITE_FIREBASE_APP_ID=1:62356046043:web:b409b6af5c4a7e7969fe
VITE_FIREBASE_MEASUREMENT_ID=G-HG1KHBHWHG

# Google OAuth (para Google Drive)
VITE_GOOGLE_CLIENT_ID=123456789-abcdefg.apps.googleusercontent.com
VITE_GOOGLE_DRIVE_FOLDER_ID=1a2b3c4d5e6f7g8h9i0j
```

‚ö†Ô∏è **N√ÉO** commite o arquivo `.env` no Git! Ele j√° deve estar no `.gitignore`.

üí° **Dica**: Voc√™ pode copiar o arquivo `.env.example` como base e preencher com seus valores.

### 5.2. Produ√ß√£o no GitHub Pages

Como o `.env` n√£o √© publicado no GitHub Pages, voc√™ precisa configurar **GitHub Secrets**:

1. Acesse o reposit√≥rio no GitHub
2. V√° em **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. Clique em **"New repository secret"**
4. Crie os seguintes secrets:

   **Google OAuth (para Google Drive):**
   - **Nome**: `VITE_GOOGLE_CLIENT_ID`
     - **Valor**: Cole o ID do cliente OAuth que voc√™ obteve no Passo 3
   - **Nome**: `VITE_GOOGLE_DRIVE_FOLDER_ID`
     - **Valor**: Cole o ID da pasta do Google Drive que voc√™ obteve no Passo 4

   **Firebase (obrigat√≥rio):**
   - **Nome**: `VITE_FIREBASE_API_KEY`
     - **Valor**: Sua Firebase API Key (veja `FIREBASE_SETUP.md` para obter)
   - **Nome**: `VITE_FIREBASE_AUTH_DOMAIN`
     - **Valor**: Seu dom√≠nio de autentica√ß√£o do Firebase
   - **Nome**: `VITE_FIREBASE_PROJECT_ID`
     - **Valor**: ID do seu projeto Firebase
   - **Nome**: `VITE_FIREBASE_STORAGE_BUCKET`
     - **Valor**: Bucket de armazenamento do Firebase
   - **Nome**: `VITE_FIREBASE_MESSAGING_SENDER_ID`
     - **Valor**: Sender ID do Firebase
   - **Nome**: `VITE_FIREBASE_APP_ID`
     - **Valor**: App ID do Firebase
   - **Nome**: `VITE_FIREBASE_MEASUREMENT_ID`
     - **Valor**: Measurement ID do Firebase (Analytics)

‚ö†Ô∏è **Importante**: Os nomes dos secrets devem ser **EXATAMENTE** como acima (com `VITE_` no in√≠cio).

#### Como Funciona?

- Durante o **build** no GitHub Actions, essas secrets s√£o injetadas como vari√°veis de ambiente
- O Vite compila o c√≥digo e **embute essas vari√°veis** no JavaScript final
- No navegador, essas vari√°veis s√£o acess√≠veis via `import.meta.env.VITE_*`
- Isso √© **seguro** porque o Client ID do Google OAuth √© **feito para ser p√∫blico** no frontend

üìñ **Leia mais**: Veja a se√ß√£o [üîç Como Funcionam as Vari√°veis de Ambiente no GitHub Pages](#-como-funcionam-as-vari√°veis-de-ambiente-no-github-pages) abaixo.

---

## üîß Passo 6: Configura√ß√£o no C√≥digo

O c√≥digo j√° est√° configurado para usar Google Identity Services (GIS), que √© a API moderna do Google. N√£o √© necess√°rio instalar depend√™ncias adicionais - as bibliotecas s√£o carregadas via CDN.

**Importante**: O sistema usa Google Identity Services (GIS) em vez da API antiga `gapi.auth2`, que foi depreciada pelo Google.

---

## üîß Passo 7: Configurar dom√≠nios autorizados (ap√≥s deploy)

Quando fizer o deploy para produ√ß√£o:

1. Volte ao Google Cloud Console ‚Üí **"APIs e Servi√ßos"** ‚Üí **"Credenciais"**
2. Clique no seu **ID do cliente OAuth**
3. Em **"Origens JavaScript autorizadas"**, adicione:
   - URL do seu site (ex: `https://seu-usuario.github.io`)
4. Em **"URIs de redirecionamento autorizados"**, adicione:
   - URL do seu site (ex: `https://seu-usuario.github.io`)
5. Salve as altera√ß√µes

---

## ‚úÖ Verifica√ß√£o

Ap√≥s configurar tudo:

1. Reinicie o servidor de desenvolvimento (`npm run dev`)
2. Tente fazer upload de uma imagem
3. Na primeira vez, ser√° solicitada autoriza√ß√£o do Google
4. Ap√≥s autorizar, o upload deve funcionar automaticamente

---

## üîê Seguran√ßa

‚ö†Ô∏è **Importante**:
- O **ID do Cliente** pode ser exposto no frontend (√© normal)
- A **Chave Secreta** N√ÉO deve ser exposta (n√£o √© usada no frontend)
- Para produ√ß√£o, limite os dom√≠nios autorizados
- Revise periodicamente os acessos no Google Cloud Console

---

## üìù Notas

- O escopo `drive.file` permite apenas criar/editar arquivos que o app criou
- Para acesso total ao Drive, seria necess√°rio `drive`, mas n√£o recomendamos por seguran√ßa
- Os arquivos ser√£o criados na pasta especificada em `VITE_GOOGLE_DRIVE_FOLDER_ID`

---

## üîß Formato de URLs de Imagens

Ap√≥s o upload ou convers√£o, as imagens s√£o armazenadas no formato:
```
https://lh3.googleusercontent.com/d/FILE_ID
```

**Importante**: 
- Este formato √© usado diretamente no `src` das tags `<img>`
- O sistema converte automaticamente links compartilh√°veis do Google Drive para este formato
- A fun√ß√£o `ensureImageUrl()` garante que as URLs estejam no formato correto antes de exibir

**Nota**: Se uma imagem n√£o estiver sendo exibida, verifique:
1. Se o arquivo est√° compartilhado como "Qualquer pessoa com o link"
2. Se a URL est√° no formato correto (usando `ensureImageUrl()`)
3. Se h√° erros no console do navegador

---

## üîç Como Funcionam as Vari√°veis de Ambiente no GitHub Pages

### ‚ùì O Problema

GitHub Pages √© um servi√ßo de **hospedagem est√°tica** - ele s√≥ serve arquivos HTML, CSS e JavaScript compilados. N√£o h√° servidor rodando que possa ler arquivos `.env` em tempo de execu√ß√£o.

### ‚úÖ A Solu√ß√£o

O **Vite** resolve isso de forma inteligente:

1. **Durante o build**: Vari√°veis que come√ßam com `VITE_` s√£o **embutidas diretamente no JavaScript** no momento da compila√ß√£o
2. **No GitHub Actions**: Usamos **GitHub Secrets** para passar essas vari√°veis durante o build
3. **Resultado**: As vari√°veis ficam "hardcoded" no JavaScript compilado, mas de forma segura

### üìã Fluxo Completo

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. Desenvolvimento Local                                ‚îÇ
‚îÇ    ‚Ä¢ Voc√™ cria arquivo .env local                       ‚îÇ
‚îÇ    ‚Ä¢ Vite l√™ as vari√°veis do .env                       ‚îÇ
‚îÇ    ‚Ä¢ Durante `npm run dev`, vari√°veis s√£o usadas       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. Push para GitHub                                     ‚îÇ
‚îÇ    ‚Ä¢ Voc√™ faz push do c√≥digo                            ‚îÇ
‚îÇ    ‚Ä¢ GitHub Actions detecta o push                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. GitHub Actions Build                                 ‚îÇ
‚îÇ    ‚Ä¢ Workflow roda `npm run build`                      ‚îÇ
‚îÇ    ‚Ä¢ GitHub Secrets s√£o injetadas como env vars         ‚îÇ
‚îÇ    ‚Ä¢ Vite compila e EMBUTE as vari√°veis no JS           ‚îÇ
‚îÇ    ‚Ä¢ Resultado: dist/ com JS contendo as vari√°veis      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. Deploy no GitHub Pages                                ‚îÇ
‚îÇ    ‚Ä¢ GitHub Pages serve os arquivos est√°ticos           ‚îÇ
‚îÇ    ‚Ä¢ No navegador, import.meta.env.VITE_* funciona!     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üîê Por Que √â Seguro?

- **Client ID do Google OAuth** √© **feito para ser p√∫blico** - √© normal que apare√ßa no JavaScript
- O **Client Secret** N√ÉO √© usado no frontend (n√£o precisamos dele)
- As secrets do GitHub s√≥ s√£o acess√≠veis durante o build, n√£o ficam expostas publicamente
- O JavaScript compilado com as vari√°veis √© p√∫blico, mas isso √© o comportamento esperado para credenciais p√∫blicas de frontend

### ‚ö†Ô∏è Importante

- **NUNCA** use secrets que devem ser privadas no frontend (como API keys secretas)
- Use apenas credenciais **p√∫blicas** (como OAuth Client IDs) que s√£o feitas para serem expostas
- Se precisar de secrets reais, use um backend pr√≥prio (n√£o GitHub Pages)

---

**√öltima atualiza√ß√£o**: Dezembro 2024

